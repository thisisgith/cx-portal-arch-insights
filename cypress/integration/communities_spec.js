// Hard-coded URL and title mapping
const communitiesMapping = [
	{
		usecase: 'Campus Network Assurance',
		title: 'Wireless & Mobility',
		url: 'https://cloudsso-test.cisco.com/idp/startSSO.ping?PartnerSpId=https://community-stage.cisco.com/auth/saml&TARGET=https://community-stage.cisco.com/t5/wireless-and-mobility/bd-p/5956-discussions-getting-started-wireles',
		pitstops: [
			{
				name: 'Onboard',
				curatedTooltip: 'Campus Network Assurance',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-assurance/bd-p/ibn-assurance',
			},
			{
				name: 'Implement',
				curatedTooltip: 'Campus Network Assurance',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-assurance/bd-p/ibn-assurance',
			},
			{
				name: 'Use',
				curatedTooltip: 'Campus Network Assurance',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-assurance/bd-p/ibn-assurance',
			},
			{
				name: 'Engage',
				curatedTooltip: 'Campus Network Assurance',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-assurance/bd-p/ibn-assurance',
			},
			{
				name: 'Adopt',
				curatedTooltip: 'Campus Network Assurance',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-assurance/bd-p/ibn-assurance',
			},
			{
				name: 'Optimize',
				curatedTooltip: 'Campus Network Assurance',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-assurance/bd-p/ibn-assurance',
			},
		],
	},
	{
		usecase: 'Campus Network Segmentation',
		title: 'Software-Defined Access (SD-Access)',
		url: 'https://cloudsso-test.cisco.com/idp/startSSO.ping?PartnerSpId=https://community-stage.cisco.com/auth/saml&TARGET=https://community-stage.cisco.com/t5/software-defined-access-sda/bd-p/discussions-sd-access',
		pitstops: [
			{
				name: 'Onboard',
				curatedTooltip: 'Campus Network Segmentation',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-segmentation/bd-p/ibn-segmentation',
			},
			{
				name: 'Implement',
				curatedTooltip: 'Campus Network Segmentation',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-segmentation/bd-p/ibn-segmentation',
			},
			{
				name: 'Use',
				curatedTooltip: 'Campus Network Segmentation',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-segmentation/bd-p/ibn-segmentation',
			},
			{
				name: 'Engage',
				curatedTooltip: 'Campus Network Segmentation',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-segmentation/bd-p/ibn-segmentation',
			},
			{
				name: 'Adopt',
				curatedTooltip: 'Campus Network Segmentation',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-segmentation/bd-p/ibn-segmentation',
			},
			{
				name: 'Optimize',
				curatedTooltip: 'Campus Network Segmentation',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-network-segmentation/bd-p/ibn-segmentation',
			},
		],
	},
	{
		usecase: 'Scalable Access Policy',
		title: 'Software-Defined Access (SD-Access)',
		url: 'https://cloudsso-test.cisco.com/idp/startSSO.ping?PartnerSpId=https://community-stage.cisco.com/auth/saml&TARGET=https://community-stage.cisco.com/t5/software-defined-access-sda/bd-p/discussions-sd-access',
		pitstops: [
			{
				name: 'Onboard',
				curatedTooltip: 'Scalable Access Policy',
				curatedURL: 'https://community-stage.cisco.com/t5/scalable-access-policy/bd-p/ibn-policy',
			},
			{
				name: 'Implement',
				curatedTooltip: 'Scalable Access Policy',
				curatedURL: 'https://community-stage.cisco.com/t5/scalable-access-policy/bd-p/ibn-policy',
			},
			{
				name: 'Use',
				curatedTooltip: 'Scalable Access Policy',
				curatedURL: 'https://community-stage.cisco.com/t5/scalable-access-policy/bd-p/ibn-policy',
			},
			{
				name: 'Engage',
				curatedTooltip: 'Scalable Access Policy',
				curatedURL: 'https://community-stage.cisco.com/t5/scalable-access-policy/bd-p/ibn-policy',
			},
			{
				name: 'Adopt',
				curatedTooltip: 'Scalable Access Policy',
				curatedURL: 'https://community-stage.cisco.com/t5/scalable-access-policy/bd-p/ibn-policy',
			},
			{
				name: 'Optimize',
				curatedTooltip: 'Scalable Access Policy',
				curatedURL: 'https://community-stage.cisco.com/t5/scalable-access-policy/bd-p/ibn-policy',
			},
		],
	},
	{
		usecase: 'Network Device Onboarding',
		title: 'Cisco Digital Network Architecture (DNA)',
		url: 'https://cloudsso-test.cisco.com/idp/startSSO.ping?PartnerSpId=https://community-stage.cisco.com/auth/saml&TARGET=https://community-stage.cisco.com/t5/digital-network-architecture/bd-p/discussions-dna',
		pitstops: [
			{
				name: 'Onboard',
				curatedTooltip: 'Network Device Onboarding',
				curatedURL: 'https://community-stage.cisco.com/t5/network-device-onboarding/bd-p/ibn-onboarding',
			},
			{
				name: 'Implement',
				curatedTooltip: 'Network Device Onboarding',
				curatedURL: 'https://community-stage.cisco.com/t5/network-device-onboarding/bd-p/ibn-onboarding',
			},
			{
				name: 'Use',
				curatedTooltip: 'Network Device Onboarding',
				curatedURL: 'https://community-stage.cisco.com/t5/network-device-onboarding/bd-p/ibn-onboarding',
			},
			{
				name: 'Engage',
				curatedTooltip: 'Network Device Onboarding',
				curatedURL: 'https://community-stage.cisco.com/t5/network-device-onboarding/bd-p/ibn-onboarding',
			},
			{
				name: 'Adopt',
				curatedTooltip: 'Network Device Onboarding',
				curatedURL: 'https://community-stage.cisco.com/t5/network-device-onboarding/bd-p/ibn-onboarding',
			},
			{
				name: 'Optimize',
				curatedTooltip: 'Network Device Onboarding',
				curatedURL: 'https://community-stage.cisco.com/t5/network-device-onboarding/bd-p/ibn-onboarding',
			},
		],
	},
	{
		usecase: 'Campus Software Image Management',
		title: 'Cisco Digital Network Architecture (DNA)',
		url: 'https://cloudsso-test.cisco.com/idp/startSSO.ping?PartnerSpId=https://community-stage.cisco.com/auth/saml&TARGET=https://community-stage.cisco.com/t5/digital-network-architecture/bd-p/discussions-dna',
		pitstops: [
			{
				name: 'Onboard',
				curatedTooltip: 'Campus Software Image Management',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-software-image-management/bd-p/ibn-swim',
			},
			{
				name: 'Implement',
				curatedTooltip: 'Campus Software Image Management',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-software-image-management/bd-p/ibn-swim',
			},
			{
				name: 'Use',
				curatedTooltip: 'Campus Software Image Management',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-software-image-management/bd-p/ibn-swim',
			},
			{
				name: 'Engage',
				curatedTooltip: 'Campus Software Image Management',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-software-image-management/bd-p/ibn-swim',
			},
			{
				name: 'Adopt',
				curatedTooltip: 'Campus Software Image Management',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-software-image-management/bd-p/ibn-swim',
			},
			{
				name: 'Optimize',
				curatedTooltip: 'Campus Software Image Management',
				curatedURL: 'https://community-stage.cisco.com/t5/campus-software-image-management/bd-p/ibn-swim',
			},
		],
	},
];

describe('Communities Panel', () => {
	before(() => {
		cy.login();
		cy.window().then(win => { // Must be done before app loads
			win.localStorage.quickTourFirstTime = { firstTime: false };
		});
		cy.loadApp();
		cy.window().then(win => { // Must be done after app loads
			win.Cypress.hideDNACHeader = true;
		});
		cy.waitForAppLoading();
	});

	context('PBC-358: (UI View) - Solution Racetrack - View Public Community Forum', () => {
		// PBC-358 Hard-codes the URL mappings for communities based on use case
		after(() => {
			// Make sure we're switched back to the default use case
			cy.getByAutoId('UseCaseDropdown').click();
			cy.getByAutoId('TechnologyDropdown-Campus Network Segmentation').click();
		});

		it('Correctly formats the communities tile', () => { // PBC-126, PBC-585
			cy.getByAutoId('PanelTitle-Communities')
				.should('have.text', 'Cisco Community')
				.and('have.class', 'text-uppercase');
			cy.getByAutoId('CuratedCommunityLink').within(() => {
				cy.get('.icon-communities').should('be.visible');
				cy.get('#curatedcommunitytitle').should('have.text', 'Success Track');
			});
			cy.getByAutoId('PublicCommunityLink').within(() => {
				cy.get('.icon-communities').should('be.visible');
				cy.get('#publiccommunitytitle').should('have.text', 'Public');
			});
		});

		communitiesMapping.forEach(mapping => {
			it(`Public Community Links for use case: ${mapping.usecase}`, () => {
				// Switch to use case
				cy.getByAutoId('UseCaseDropdown').click();
				cy.getByAutoId(`TechnologyDropdown-${mapping.usecase}`).click();

				// Verify the communities public URL and tooltip
				cy.getByAutoId(`communitytitle-${mapping.title}-Public`)
					.should('exist')
					.and('have.attr', 'title', mapping.title)
					.and('have.attr', 'data-auto-href', mapping.url)
					.and('have.attr', 'data-toggle', 'tooltip');	// tooltip
			});

			// PBC-97, PBC-451, PBC-585
			context(`PBC-97: Success Track Communities Link for ${mapping.usecase}`, () => {
				beforeEach(() => {
					// Switch to use case
					cy.getByAutoId('UseCaseDropdown').click();
					cy.getByAutoId(`TechnologyDropdown-${mapping.usecase}`).click();
				});

				mapping.pitstops.forEach(pitstop => {
					it(`Success Track Community Links for pitstop: ${pitstop.name}`, () => {
						cy.getByAutoId(`Racetrack-Point-${pitstop.name}`)
							.click({ force: true });

						// Verify Success Track URL (potentially different for each pitstop)
						cy.getByAutoId(`communitytitle-${pitstop.curatedTooltip}-Lifecycle`)
							.should('have.text', 'Success Track')
							.and('have.attr', 'title', pitstop.curatedTooltip)
							.and('have.attr', 'data-auto-href', pitstop.curatedURL);

						// Verify the communities public URL (should NOT change per pitstop)
						cy.getByAutoId(`communitytitle-${mapping.title}-Public`)
							.should('exist')
							.and('have.attr', 'title', mapping.title)
							.and('have.attr', 'data-auto-href', mapping.url);
					});
				});
			});
		});
	});

	it('PBC-717: Update "Cisco Community" link in CX Portal header to point to stage', () => {
		cy.getByAutoId('HeaderCommunityLink')
			.should('have.attr', 'href', 'https://cloudsso-test.cisco.com/idp/startSSO.ping?PartnerSpId=https://community-stage.cisco.com/auth/saml&TARGET=https://community-stage.cisco.com/');
	});
});
