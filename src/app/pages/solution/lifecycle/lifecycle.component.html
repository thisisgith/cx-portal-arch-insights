<div class="panel panel--ltgray panel--bordered no-padding base-padding-right">
	<div class="row base-padding-top">
		<div class="col-md-2" *ngIf="!status.loading.racetrack">
			<ng-container *ngTemplateOutlet="racetrack"></ng-container>
		</div>

		<div class="col-md-10">
			<div class="row">
				<div class="col-md-4">
					<ng-container *ngTemplateOutlet="panel; context: {
							template: atxPanel,
							title: '_AskTheExpert_',
							loading: status.loading.atx,
							data: componentData.atx,
							viewAllLabel: '_ViewAll_',
							viewAll: 'atx'
						}">
					</ng-container>
					<ng-container *ngTemplateOutlet="panel; context: {
							template: communityPanel,
							title: '_Communities_',
							loading: status.loading.communities,
							data: componentData.communities,
							viewAllLabel: '_SearchCommunities_',
							viewAll: 'communities'
						}">
					</ng-container>
				</div>
				<div class="col-md-4">
					<ng-container *ngTemplateOutlet="panel; context: {
							template: learnPanel,
							title: '_Learn_',
							loading: (status.loading.elearning && !status.loading.success),
							data: componentData.learning
						}">
					</ng-container>
				</div>
				<div class="col-md-4">
					<ng-container *ngTemplateOutlet="panel; context: {
							template: accPanel,
							title: '_Accelerator_',
							loading: status.loading.acc,
							data: componentData.acc
						}">
					</ng-container>
				</div>
			</div>
		</div>
	</div>
</div>
	
<div class="modal-container" *ngIf="modal.visible">
	<div class="modal-backdrop" [ngClass]="{ hide: !modal.visible }"></div>
	<div class="modal modal--full" [ngClass]="{ hide: !modal.visible }">
		<div class="modal__dialog">
			<ng-container *ngTemplateOutlet="modal.content; context: modal.context"></ng-container>
		</div>
	</div>
</div>

<ng-template #racetrack>
	<div class="row base-padding-left">
		<div class="col-md-7">
			<h2 class="text-primary" *ngIf="currentPitstop" [innerText]="currentPitstop.name"></h2>
		</div>
		<div class="col-md-5 flex-center">
			<span id="compActPct" class="text-white qtr-padding-top" [innerText]="currentActionsCompPert"></span>
			<span><img class="finishline qtr-margin-top" alt="'_FinishLine_' | i18n" src="assets/img/solutions/finishline_side.png"> </span>
		</div>
	</div>
	<div class="half-padding-top half-padding-left">
		<app-racetrack *ngIf="!status.racetrackLoading && componentData?.racetrack?.stage"
			[stage]="componentData.racetrack.stage">
		</app-racetrack>
		<div class="half-padding-left">
			<span *ngIf="currentPitstop" [innerHTML]="'_DuringXStage_' | i18n:currentPitstop.name"></span>
			<span [ngSwitch]="componentData?.racetrack?.stage">
				<span *ngSwitchCase="'onboard'" [innerHTML]="'_OnboardDescription_' | i18n"></span>
				<span *ngSwitchCase="'implement'" [innerHTML]="'_ImplementDescription_' | i18n"></span>
				<span *ngSwitchCase="'adopt'" [innerHTML]="'_AdoptDescription_' | i18n"></span>
			</span>
		</div>
	</div>
	<div class="base-margin-left" *ngIf="currentPitstop && currentPitstop?.pitstopActions?.length">
		<div class="divider divider--compressed"></div>
		<div class="half-padding-bottom text-uppercase" [innerText]="'_Actions_' | i18n"></div>
		<div *ngFor="let action of currentPitActionsWithStatus" class="form-group form-group select">
			<div class="actionname row qtr-padding-top qtr-padding-bottom" [ngClass]="{selected: action.selected}">
				<div class="col-md-2">
					<label class="checkbox" [ngClass]="{'disabled': action.action.isComplete}">
						<input data-auto-id="pitstopCheckbox" type="checkbox" [(ngModel)]="action.action.isComplete"
							(change)="completeAction(action.action)" [checked]="action.action.isComplete">
						<span class="checkbox__input"></span>
					</label>
				</div>
				<div class="col-md-10">
					<a data-auto-id="actionlink" class="no-link" [ngClass]="{'disabled': action.action.isComplete}"
						(click)="selectAction(action)">
						<div>
							<span class="checkbox__label text-medium" [innerText]="action.action.name"></span>
							<span *ngIf="action.action.isCompleteAuto" class="qtr-padding-top">
								<img class="small-size" alt="'_Auto_' | i18n" src="assets/img/solutions/auto_img.png">
							</span>
						</div>
					</a>
				</div>
			</div>
			<div *ngIf="action.selected" class="des-dropdown base-padding-left half-margin-top half-margin-bottom">
				<span class="text-small" [innerText]="action.action.description"></span>
			</div>
		</div>			
	</div>
</ng-template>

<ng-template #atxPanel let-data="data">
	<ng-container *ngIf="data.recommended">
		<ng-container *ngTemplateOutlet="recommended; context: {
				template: recommendedATX,
				title: data.recommended.title,
				src: 'assets/img/solutions/driver.png'
			}">
		</ng-container>
	</ng-container>
	<ng-container *ngIf="data.sessions.length">
		<ng-container *ngTemplateOutlet="more; context: { data: data.sessions }"></ng-container>
	</ng-container>
	<ng-container *ngIf="componentData?.atx?.recommended">
		<ng-container *ngTemplateOutlet="recommendedATXSchedule; context: { data: componentData.atx.recommended }"></ng-container>
	</ng-container>
</ng-template>

<ng-template #recommended let-src="src" let-title="title" let-template="template">
	<div class="qtr-padding-bottom">
		<span class="icon-flagged qtr-padding-right qtr-padding-bottom"></span>
		<span class="text-uppercase" [innerText]="'_Recommended_' | i18n"></span>
	</div>
	<div class="panel panel--bordered panel no-padding-top no-padding-left no-padding-right round-edges">
		<img class="round-edges-top max-width" alt="'_Placeholder_' | i18n" [src]="src">
		<div class="base-padding-top half-padding-left">
			<div class="text-large base-padding-bottom" [innerText]="title"></div>
			<ng-container *ngTemplateOutlet="template"></ng-container>
		</div>
	</div>
</ng-template>

<ng-template #recommendedATX>
	<button data-auto-id="recommendedATXScheduleButton"
		class="btn btn--small btn--gray-ghost text-uppercase"
		(click)="atxScheduleCardOpened = true"
		[innerText]="'_Schedule_' | i18n">
	</button>
	<button class="btn btn--small btn--gray-ghost text-uppercase" [innerText]="'_WatchNow_' | i18n"></button>
</ng-template>

<ng-template #recommendedACC>
	<button class="btn btn--small btn--gray-ghost text-uppercase" [innerText]="'_Register_' | i18n"></button>
</ng-template>

<ng-template #recommendedATXSchedule let-data="data">
	<div class="panel panel--open panel--bordered"
		*ngIf="atxScheduleCardOpened">
		<div class="row base-margin-top half-margin-left half-margin-right">
			<div id="atxtitle" class="col-md-11 text-left">
				<h5 [innerText]="data.title"></h5>
			</div>
			<div class="col-md-1">
				<a class="no-link fade-in-pop closebtn"
					(click)="this.atxScheduleCardOpened = false"
					data-auto-id="AtxScheduleCardClose">
					<span class="icon-close icon-small"></span>
				</a>
			</div>
		</div>
		<div id="atxdescription" class="base-margin-left base-margin-right half-margin-top text-left">
			<span class="text-small" [innerText]="data.description"></span>
		</div>
		<div class="half-margin-top base-margin-left base-margin-bottom text-left">
			<a data-auto-id="viewOnDemand"
				class="no-link fade-in-pop"
				[href]="data.viewOnDemandUrl">
				<div class="flex">
					<div class="btn--square">
						<span class="icon-play icon-small"></span>
					</div>
					<div class="half-margin-left flex-fluid">
						<span class="text-small" [innerText]="'_WatchNow_' | i18n"></span>
					</div>
				</div>
			</a>
		</div>
		<h6 class="half-margin-left base-margin-top half-margin-bottom base-margin-left text-left"
			[innerText]="'_ChooseSession_' | i18n">
		</h6>
		<div class="session-table responsive-table half-margin-left">
			<table class="table table--bordered table--selectable">
				<tbody>
					<tr attr.data-auto-id="SelectSession-{{ session.title }}"
						*ngFor="let session of data.sessions"
						(click)="selectSession(session)"
						[ngClass]="{ 'active': sessionSelected?.date === session.date && sessionSelected?.time === session.time }">
						<td class="text-xsmall" [innerText]="session.date"></td>
						<td class="text-xsmall" [innerText]="session.time"></td>
						<td class="text-xsmall" [innerText]="data.moderator"></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="row">
			<div class="col-md-8">
				<a data-auto-id="AtxScheduleCardRegisterButton"
					class="pull-left"
					[href]="data.registrationUrl">
					<button class="btn base-margin-top base-margin-left"
						[innerText]="'_Register_' | i18n">
					</button>
				</a>
			</div>
			<div class="col-md">
				<div class="row flex-center-vertical dbl-margin-top base-margin-right pull-right">
					<span class="icon-clock icon-small half-padding-right"></span>
					<span class="text-xsmall" [innerText]="data.duration"></span>
				</div>
			</div>
		</div>
	</div>
</ng-template>

<ng-template #accPanel let-data="data">
	<div innerText="{{ '_UpgradeToCXLevelX_' | i18n:3 }} {{ '_Accelerator1on1CoachingDescription_' | i18n }}"></div>
	<button class="btn btn--small btn--gray-ghost base-margin-top base-margin-bottom text-uppercase"
		[innerText]="'_ContactUs_' | i18n">
	</button>

	<ng-container *ngIf="data.recommended">
		<ng-container *ngTemplateOutlet="recommended; context: {
				template: recommendedACC,
				title: data.recommended.title,
				src: 'assets/img/solutions/acc.png'
			}">
		</ng-container>
	</ng-container>
	<ng-container *ngIf="data.sessions.length">
		<ng-container *ngTemplateOutlet="more; context: { data: data.sessions }"></ng-container>
	</ng-container>
</ng-template>

<ng-template #more let-data="data">
	<div class="base-padding-top half-padding-bottom">
		<span class="text-large text-uppercase" [innerText]="'_More_' | i18n"></span>
	</div>
	<div class="more-scroll base-padding-bottom">
		<div class="qtr-padding-bottom" *ngFor="let item of data | slice:1">
			<span [innerText]="item.title"></span>
		</div>
	</div>
</ng-template>

<ng-template #communityPanel let-data="data">
	<div *ngFor="let community of data">
		<div class="half-padding-left">
			<span class="icon-communities qtr-padding-right"></span>
			<span [innerText]="community.title"></span>
			<span class="icon-play icon-tiny qtr-padding-left qtr-padding-bottom"></span>
		</div>
	</div>
</ng-template>

<ng-template #learnPanel let-data="data">
	<div *ngIf="data.elearning?.length">
		<ng-container *ngTemplateOutlet="learningBlock; context:
			{ icon: 'clipboard-md', title: '_ELearning_', data: componentData.learning.elearning }">
		</ng-container>
		<div class="divider"></div>
	</div>

	<div *ngIf="data.certifications?.length">
		<ng-container *ngTemplateOutlet="learningBlock; context:
			{ icon: 'certified', title: '_Certifications_', data: componentData.learning.certifications }">
		</ng-container>
		<div class="divider"></div>
	</div>

	<div *ngIf="data.training?.length">
		<ng-container *ngTemplateOutlet="learningBlock; context:
			{ icon: 'audio-broadcast',title: '_RemoteLearningLabs_', data: componentData.learning.training }">
		</ng-container>
		<div class="divider"></div>
	</div>

	<div *ngIf="data.success?.length">
		<ng-container *ngTemplateOutlet="learningBlock; context:
			{ icon: 'transit',title: '_SuccessPaths_', data: componentData.learning.success }">
		</ng-container>
	</div>
</ng-template>

<ng-template #learningBlock let-title="title" let-data="data" let-icon="icon">
	<div class="row">
		<div class="col-md-9">
			<span class="icon-{{ icon }} qtr-padding-right qtr-padding-bottom"></span>
			<span class="text-uppercase text-large text-muted" [innerText]="title | i18n"></span>
		</div>
		<div class="col-md-3 text-right">
			<span [innerText]="'_ViewAll_' | i18n"></span>
			<span class="icon-play qtr-padding-bottom qtr-padding-left"></span>
		</div>
	</div>
	<div class="base-padding-bottom half-padding-top half-padding-left">
		<div class="qtr-padding-bottom" *ngFor="let item of data">
			<span [innerText]="item.title"></span>
		</div>
	</div>
</ng-template>

<ng-template #atxModal let-data="data">
	<div id="atxModal" class="modal__content no-padding">

		<div class="modal__header atx__header half-padding-left half-padding-bottom no-margin-bottom">
			<div class="row half-padding-top">
				<div class="col-md-11 half-margin-top base-padding-left">
					<div class="text-xlarge text-left text-white" [innerText]="'_AskTheExpert_' | i18n"></div>
					<div class="text-medium text-left text-white" [innerText]="'_AvailableLive_' | i18n"></div>
				</div>
				<div class="col-md-1 half-margin-top">
					<span (click)="closeModal()"
						data-auto-id="ATXCloseModal"
						class="icon-close icon-medium text-right text-white"></span>
				</div>
			</div>
		</div>

		<div class="modal__body base-padding">
			<div class="text-large text-bold text-left" 
				[innerText]="'_TopicsAvailable_' | i18n:data.length">
			</div>

			<div class="grid grid--3up base-padding-top">
				<div class="card atx__card__background" *ngFor="let item of data">
					<div class="icon-bookmark icon-medium" [ngClass]="getRibbonClass(item)"></div>
					<div class="icon-star star" *ngIf="item.status === 'completed'"></div>
					<div class="card__header text-left text-bold" [innerText]="item.title"></div>
					<div class="card__body atx-card__body text-left" [innerText]="item.description"></div>
					<div class="card__footer">
						<div class="card_footer_item">
							<div class="text-left">
								<a data-auto-id="viewOnDemand" class="no-link fade-in-pop" [href]="item.viewOnDemandUrl">
									<span class="icon-play-contained icon-small half-padding-right"></span>
									<span [innerText]="'_WatchNow_' | i18n"></span>
								</a>
							</div>
							<div class="text-left">
								<a data-auto-id="recommendedATXScheduleButton" class="no-link fade-in-pop"
									(click)="atxScheduleCardOpened = true; componentData.atx.interested = item">
									<span class="icon-calendar icon-small half-padding-right"></span>
									<span [innerText]="'_ViewSessions_' | i18n"></span>
								</a>
							</div>
							<div class="divider divider--compressed"></div>
							<div class="pull-right">
								<span class="icon-clock icon-small half-padding-right"></span>
								<span [innerText]="item.duration"></span>
							</div>
						</div>
					</div>				
					<ng-container *ngIf="item == componentData.atx.interested && atxScheduleCardOpened">
						<ng-container *ngTemplateOutlet="recommendedATXSchedule; context: { data: componentData.atx.interested }">
						</ng-container>
					</ng-container>
				</div>
			</div>
		</div>
	</div>
</ng-template>

<ng-template #coaching let-results="results">
	<div id="coachingModal" class="modal__content no-padding">
		<div class="modal__header webinar-title-background no-margin">
			<div class="row half-padding-top">
				<div class="col-md-11 half-margin-top base-padding-left">
					<div class="text-xlarge text-left text-white" [innerText]="'_Accelerator_' | i18n"></div>
				</div>
				<div class="col-md-1 half-margin-top">
					<span (click)="closeModal()" data-auto-id="WebinarModalClose" class="icon-close icon-medium text-right"></span>
				</div>
			</div>
		</div>
		<div class="modal__body">
			<div class="base-padding-left text-medium text-bold text-left half-padding-bottom half-padding-top" [innerText]="'_TopicsAvailable_' | i18n:results.webinars.length"></div>
			<div class="row base-padding-left base-padding-right base-padding-bottom">
				<div class="col-md-3 base-padding-bottom" *ngFor="let result of results.webinars">
					<div class="card max-height tab-background">
						<div class="card__header text-left text-bold" [innerText]="result.title"></div>
						<div class="card__body webinar-card text-left" [innerText]="result.summary"></div>
						<div class="card__footer">
							<div class="col-md-8">
								<div class="row">
									<span class="icon-play-contained icon-small half-padding-right"></span>
									<span [innerText]="'_WatchOnDemand_' | i18n"></span>
								</div>
								<div class="row">
									<span class="icon-calendar icon-small half-padding-right"></span>
									<span [innerText]="'_ChooseSession_' | i18n"></span>
								</div>
							</div>
							<div class="col-md">
								<div class="row flex-center-vertical">
									<span class="icon-clock icon-small half-padding-right"></span>
									<span [innerText]="'_Placeholder_' | i18n"></span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</ng-template>

<ng-template #panel let-template="template" let-title="title" let-loading="loading" let-data="data" let-viewAll="viewAll" let-viewAllLabel="viewAllLabel">
	<div class="panel base-padding-top base-padding-left base-padding-right base-margin-bottom">
		<div class="row base-padding-bottom">
			<div class="col-md-6 flex-center-vertical">
				<div class="text-uppercase text-large" [innerText]="title | i18n"></div>
			</div>
			<div class="col-md-6 text-right" *ngIf="viewAll">
				<div *ngIf="data"
					(click)="showModal(viewAll)"
					attr.data-auto-id="ShowModalPanel-{{ title }}">
					<span class="text-right text-med" [innerText]="viewAllLabel | i18n"></span>
					<span class="icon-play qtr-padding-left qtr-padding-bottom"></span>
				</div>
			</div>
		</div>
	
		<div *ngIf="!loading && data">
			<ng-container *ngTemplateOutlet="template; context: { data: data }"></ng-container>
		</div>
		<div *ngIf="loading">
			<cui-spinner></cui-spinner>
		</div>
	</div>
</ng-template>