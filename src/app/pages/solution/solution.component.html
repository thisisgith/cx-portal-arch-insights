<quick-tour *ngIf="quickTourActive" [steps]="quickTourSteps"></quick-tour>
<div class="page-container">
	<div>
		<div class="cx-breadcrumb-bar">
			<ng-container *ngTemplateOutlet="breadcrumbs; context: {}"></ng-container>
		</div>
		<div id="slideout" class="expand-on-load">
			<div class="panel--blgray panel" (click)="openFeedbackModal()" data-auto-id="FeedbackModal">
				<div class="row flex-center-vertical">
					<span class="icon-feedback icon-small half-margin-left half-margin-right"></span>
					<span class="qtr-margin-left qtr-margin-right text-small" [innerText]="'_Feedback' | i18n"></span>
				</div>
			</div>
		</div>
		<div class="km" #km>
			<div
				class="km__left"
				inlineSVG="assets/icons/icon-metrics-arrow-left.svg"
				(click)="shiftCarousel(-2)"
				data-auto-id="carousel-left">
			</div>
			<div class="km__items__wrapper" #kmWrapper>
				<div class="km__items">
					<ng-container *ngFor="let facet of facets; index as i">
						<div
							[id]="facet.key"
							attr.data-auto-id="Facet-{{ facet.title }}"
							(click)="selectFacet(facet, true)"
							class="km__items__item"
							[class.km__items__item--selected]="facet.selected">
							<ng-container *ngTemplateOutlet="facet.template; context: { facet: facet }"></ng-container>
						</div>
					</ng-container>
				</div>
			</div>
			<div
				class="km__right"
				inlineSVG="assets/icons/icon-metrics-arrow-right.svg"
				(click)="shiftCarousel(2)"
				data-auto-id="carousel-right"
			></div>
		</div>
		<no-dnac-header (buttonData)="refreshButtonInfo($event)"></no-dnac-header>
	</div>

	<div #content class="content half-padding">
		<router-outlet></router-outlet>
	</div>
</div>

<ng-template #breadcrumbs>
	<div class="container">
		<div class="context-selector flex flex-fluid flex-center-vertical">
			<div class="svg-home">
				<svg viewBox="0 0 28 22" xmlns="http://www.w3.org/2000/svg">
					<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
						<g transform="translate(-96.000000, -82.000000)">
							<g transform="translate(0.000000, 51.000000)">
								<g transform="translate(95.000000, 6.000000)">
									<g transform="translate(0.000000, 21.000000)">
										<g>
											<rect id="Rectangle" fill="#FF0000" opacity="0" x="0" y="0" width="28" height="28"></rect>
											<path d="M20.0546504,22.3529412 L18.1235856,22.3529412 C17.6636704,22.3529412 17.295883,21.9806058 17.295883,21.5150035 L17.295883,15.929485 C17.295883,15.4638827 16.836209,15.0915474 16.376535,15.0915474 L10.8590003,15.0915474 C10.3990851,15.0915474 10.0312977,15.4638827 10.0312977,15.929485 L10.0312977,21.5150035 C10.0312977,21.9806058 9.57162371,22.3529412 9.11170856,22.3529412 L7.27253031,22.3529412 C6.72072859,22.3529412 6.35294118,21.9806058 6.35294118,21.5150035 L6.35294118,11.7402851 C6.35294118,11.4609725 6.53695547,11.18166 6.72072859,11.088393 L13.1578525,6.43383496 C13.4337534,6.24754521 13.8015408,6.24754521 14.1693282,6.43383496 L20.5145655,11.088393 C20.7902252,11.18166 20.8823529,11.4609725 20.8823529,11.7402851 L20.8823529,21.5150035 C20.8823529,21.9806058 20.5145655,22.3529412 20.0546504,22.3529412 M14.5735294,22.3529412 L12.6617647,22.3529412 C12.1836982,22.3529412 11.7058824,21.9900662 11.7058824,21.536294 L11.7058824,17.9073064 C11.7058824,17.4535342 12.1836982,17 12.6617647,17 L14.5735294,17 C15.1468583,17 15.5294118,17.4535342 15.5294118,17.9073064 L15.5294118,21.536294 C15.5294118,21.9900662 15.1468583,22.3529412 14.5735294,22.3529412 M2.38600312,14.1814372 L3.40619794,13.4491341 C4.05543494,13.0831025 4.89027248,13.4491341 4.89027248,14.1814372 L4.89027248,23.058602 C4.89027248,23.5163214 5.2612303,23.8823529 5.72511002,23.8823529 L22.2345575,23.8823529 C22.7908726,23.8823529 23.1620736,23.5163214 23.1620736,23.058602 L23.1620736,14.1814372 C23.1620736,13.4491341 23.9966679,13.0831025 24.5532263,13.4491341 L25.5734211,14.1814372 C26.5009373,14.9135002 27.614054,13.3576862 26.5938592,12.717071 L14.5361488,4.20593774 C14.165191,3.93135409 13.7942332,3.93135409 13.515954,4.20593774 L1.3658083,12.717071 C0.438292118,13.3576862 1.45848694,14.9135002 2.38600312,14.1814372" id="home" fill="#98ABC3"></path>
										</g>
									</g>
								</g>
							</g>
						</g>
					</g>
				</svg>
			</div>
			<div class="svg-chevron-right" *ngIf="selectedSolution">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 23">
					<polyline fill="none" stroke="#232323" points="40 27.626 50.882 36 62.619 27.626"
						opacity=".222" transform="matrix(0 1 1 0 -27 -40)"></polyline>
				</svg>
			</div>
			<div *ngIf="selectedSolution">
				<div class="group-label" [innerText]="'_Solution_' | i18n"></div>
				<div class="dropdown" data-auto-id="SolutionDropdown"
					[ngClass]="{'active': solutionDropdown }"
					(click)="useCaseDropdown = false; solutionDropdown = !solutionDropdown">
					<a class="text-color-dkgray text-size-18" [innerText]="selectedSolution.name"></a>
					<div class="dropdown__menu">
						<a *ngFor="let solution of solutions" attr.data-auto-id="SolutionDropdown-{{ solution.name }}"
							class="text-uppercase" (click)="changeSolution(solution)" [ngClass]="{
								'selected': selectedSolution.name === solution.name
							}" [innerText]="solution.name">
						</a>
					</div>
				</div>
			</div>
			<div class="svg-chevron-right" *ngIf="selectedTechnology">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 23">
					<polyline fill="none" stroke="#232323" points="40 27.626 50.882 36 62.619 27.626"
						opacity=".222" transform="matrix(0 1 1 0 -27 -40)"></polyline>
				</svg>
			</div>
			<div *ngIf="selectedTechnology">
				<div class="group-label" [innerText]="'_UseCase_' | i18n"></div>
				<div class="dropdown" data-auto-id="UseCaseDropdown" [ngClass]="{'active': useCaseDropdown }"
					(click)="solutionDropdown = false; useCaseDropdown = !useCaseDropdown">
					<a class="text-color-dkgray text-size-18" [innerText]="selectedTechnology.name">
					</a>
					<div class="dropdown__menu">
						<a *ngFor="let technology of technologies"
							attr.data-auto-id="TechnologyDropdown-{{ technology.name }}"
							(click)="changeTechnology(technology)"
							[ngClass]="{ 'selected': selectedTechnology.name === technology.name }"
							[innerText]="technology.name">
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</ng-template>

<ng-template #facetPanel>
	<div *ngFor="let facet of facets; index as i"
		attr.data-auto-id="Facet-{{ facet.title }}"
		(click)="selectFacet(facet, true)"
		class="flex flex-column panel panel--bordered-right flex-fill"
		[ngClass]="{
			'panel--bordered-left': i === 0,
			'facet--selected': facet.selected
		}">
		<div class="flex-fluid flex-center base-margin-bottom">
			<ng-container *ngTemplateOutlet="facet.template; context: { facet: facet }"></ng-container>
		</div>
	</div>
</ng-template>

<ng-template #lifecycleFacet let-facet="facet">
	<app-gauge
		textColor="#243034"
		[arcColor]="facet?.selected ? '#00bceb' : '#92dde4'"
		[percentage]="facet?.data?.gaugePercent || 0"
		[label]="facet?.label">
	</app-gauge>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected">
	</div>
</ng-template>

<ng-template #assetsFacet let-facet="facet">
	<app-gauge
		textColor="#243034"
		[arcColor]="facet?.selected ? '#00bceb' : '#92dde4'"
		[percentage]="facet?.data?.gaugePercent || 0"
		[label]="facet?.label">
	</app-gauge>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected">
	</div>
</ng-template>

<ng-template #insightsFacet let-facet="facet">
	<div *ngIf="facet?.loading" class="base-padding">
		<cui-spinner></cui-spinner>
	</div>
	<div class="kmii__detailed" *ngIf="!facet?.loading">
		<div class="kmii__insights" *ngIf="!facet?.isError">
			<span class="kmii__insights__num base-padding-top"
				[class.kmii__insights__num--selected]="facet?.selected"
				[innerText]="facet?.seriesData?.totalCnt">
			</span>
			<div class="kmii__insights__title">
				Â <div *ngIf="facet?.seriesData?.optedIn">
					<span [innerText]="facet?.seriesData?.complianceIssueCnt"></span>
					<span class="qtr-padding-left" [innerText]="'_InsightsComplianceIssues_' | i18n"></span>
				</div>
				<div>
					<span [innerText]="facet?.seriesData?.predictedCrashCnt"></span>
					<span class="qtr-padding-left" [innerText]="'_InsightsPredictedCrashes_' | i18n"></span>
				</div>
				<div>
					<span [innerText]="facet?.seriesData?.recentCrashCnt"></span>
					<span class="qtr-padding-left" [innerText]="'_InsightsRecentCrashes_' | i18n"></span>
				</div>
			</div>
			<div class="kmii__insights__change" *ngIf="false">
				<div  class="kmii__insights__arrow"
					inlineSVG="assets/icons/icon-arrow-down.svg">
				</div>
				<span [innerText]="'+2'"></span>
			</div>
		</div>
		<div class="kmii__insights__title" *ngIf="facet?.isError" [innerText]="'_InsightsNoResultsFound_' | i18n"></div>
	</div>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected"
	></div>
</ng-template>

<ng-template #advisoriesFacet let-facet="facet">
	<div class="kmii__detailed" *ngIf="!facet?.loading">
		<app-multi-gauge
			arcColor="#92dde4"
			*ngIf="facet?.seriesData"
			[data]="facet?.seriesData"
			[selected]="facet?.selected"
			[idx]="advisoryIndex"
		>
		</app-multi-gauge>
		<div
			*ngIf="!facet?.seriesData"
			class="text-muted flex-center text-large base-padding-left base-padding-right dbl-padding-top dbl-padding-bottom"
			[innerText]="'_NoOpenAdvisories_' | i18n">
		</div>
	</div>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected"
	></div>
</ng-template>

<ng-template #resolutionFacet let-facet="facet">
	<!-- TODO: Cases track needs to get trend data to draw the trend chart here -->
	<div class="kmii__detailed">
		<div class="text-left">
			<div class="kmii__resolution__item">
				<div
					class="kmii__resolution__label"
					[class.kmii__resolution__label--selected]="facet?.selected"
					[innerText]="'_OpenCases_' | i18n">
				</div>
				<div
					class="kmii_resolution__value"
					[class.kmii_resolution__value--selected]="facet?.selected"
					[innerText]="casesCount || 0">
				</div>
			</div>
			<div class="kmii__resolution__item qtr-margin-top">
				<div class="kmii__resolution__label" [innerText]="'_WithRMAs_' | i18n"></div>
				<div class="kmii_resolution__value" [innerText]="RMACount || 0"></div>
			</div>
		</div>
	</div>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected">
	</div>
</ng-template>

<cui-modal></cui-modal>
