<quick-tour *ngIf="quickTourActive" [steps]="quickTourSteps"></quick-tour>
<div class="page-container">
	<div>
		<div class="cx-breadcrumb-bar">
			<ng-container *ngTemplateOutlet="breadcrumbs; context: {}"></ng-container>
		</div>
		<div id="slideout" class="expand-on-load">
			<div class="panel--blgray panel" (click)="openFeedbackModal()" data-auto-id="FeedbackModal">
				<div class="row flex-center-vertical">
					<span class="icon-feedback icon-small half-margin-left half-margin-right"></span>
					<span class="qtr-margin-left qtr-margin-right text-small" [innerText]="'_Feedback' | i18n"></span>
				</div>
			</div>
		</div>
		<div class="km" #km>
			<div
				class="km__left"
				inlineSVG="assets/icons/icon-metrics-arrow-left.svg"
				(click)="shiftCarousel(-2)"
				data-auto-id="carousel-left">
			</div>
			<div class="km__items__wrapper" #kmWrapper>
				<div class="km__items">
					<ng-container *ngFor="let facet of facets; index as i">
						<div
							[id]="facet.key"
							attr.data-auto-id="Facet-{{ facet.title }}"
							(click)="selectFacet(facet, true)"
							class="km__items__item"
							[class.km__items__item--selected]="facet.selected">
							<ng-container *ngTemplateOutlet="facet.template; context: { facet: facet }"></ng-container>
						</div>
					</ng-container>
				</div>
			</div>
			<div
				class="km__right"
				inlineSVG="assets/icons/icon-metrics-arrow-right.svg"
				(click)="shiftCarousel(2)"
				data-auto-id="carousel-right"
			></div>
		</div>
		<no-dnac-header (buttonData)="refreshButtonInfo($event)"></no-dnac-header>
	</div>

	<div #content class="content half-padding">
		<router-outlet></router-outlet>
	</div>
</div>

<ng-template #breadcrumbs>
	<div class="container">
		<div class="cs flex flex-fluid flex-center-vertical">
			<div class="cs__home" inlineSVG="assets/icons/icon-home.svg"></div>
			<div class="cs__next-icon" inlineSVG="assets/icons/icon-arrow-breadcrumb.svg"></div>
			<div *ngIf="selectedSolution">
				<div class="group-label" [innerText]="'_SuccessTrack_' | i18n"></div>
				<div class="dropdown" data-auto-id="SolutionDropdown"
					[ngClass]="{'active': solutionDropdown }"
					(click)="useCaseDropdown = false; solutionDropdown = !solutionDropdown">
					<a class="text-color-dkgray text-size-18" [innerText]="selectedSolution.name"></a>
					<div class="dropdown__menu">
						<a *ngFor="let solution of solutions" attr.data-auto-id="SolutionDropdown-{{ solution.name }}"
							class="text-uppercase" (click)="changeSolution(solution)" [ngClass]="{
								'selected': selectedSolution.name === solution.name
							}" [innerText]="solution.name">
						</a>
					</div>
				</div>
			</div>
			<div class="cs__next-icon" inlineSVG="assets/icons/icon-arrow-breadcrumb.svg" *ngIf="selectedTechnology"></div>
			<div *ngIf="selectedTechnology">
				<div class="group-label" [innerText]="'_UseCase_' | i18n"></div>
				<div class="dropdown" data-auto-id="UseCaseDropdown" [ngClass]="{'active': useCaseDropdown }"
					(click)="solutionDropdown = false; useCaseDropdown = !useCaseDropdown">
					<a class="text-color-dkgray text-size-18" [innerText]="selectedTechnology.name">
					</a>
					<div class="dropdown__menu">
						<a *ngFor="let technology of technologies"
							attr.data-auto-id="TechnologyDropdown-{{ technology.name }}"
							(click)="changeTechnology(technology)"
							[ngClass]="{ 'selected': selectedTechnology.name === technology.name }"
							[innerText]="technology.name">
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</ng-template>

<ng-template #facetPanel>
	<div *ngFor="let facet of facets; index as i"
		attr.data-auto-id="Facet-{{ facet.title }}"
		(click)="selectFacet(facet, true)"
		class="flex flex-column panel panel--bordered-right flex-fill"
		[ngClass]="{
			'panel--bordered-left': i === 0,
			'facet--selected': facet.selected
		}">
		<div class="flex-fluid flex-center base-margin-bottom">
			<ng-container *ngTemplateOutlet="facet.template; context: { facet: facet }"></ng-container>
		</div>
	</div>
</ng-template>

<ng-template #lifecycleFacet let-facet="facet">
	<app-gauge
		textColor="#243034"
		[arcColor]="facet?.selected ? '#00bceb' : '#92dde4'"
		[percentage]="facet?.data?.gaugePercent || 0"
		[label]="facet?.label"
		data-auto-id="LifecycleAdoptionProgress">
	</app-gauge>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected">
	</div>
</ng-template>

<ng-template #assetsFacet let-facet="facet">
	<app-gauge
		textColor="#243034"
		[arcColor]="facet?.selected ? '#00bceb' : '#92dde4'"
		[percentage]="facet?.data?.gaugePercent || 0"
		[label]="facet?.label">
	</app-gauge>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected">
	</div>
</ng-template>

<ng-template #insightsFacet let-facet="facet">
	<div *ngIf="facet?.loading" class="base-padding">
		<cui-spinner></cui-spinner>
	</div>
	<div class="kmii__detailed" *ngIf="!facet?.loading">
		<div class="kmii__insights" *ngIf="!facet?.isError">
			<span class="kmii__insights__num base-padding-top"
				[class.kmii__insights__num--selected]="facet?.selected"
				[innerText]="facet?.seriesData?.totalCnt">
			</span>
			<div class="kmii__insights__title">
				Â <div *ngIf="facet?.seriesData?.optedIn">
					<span [innerText]="facet?.seriesData?.complianceIssueCnt"></span>
					<span class="qtr-padding-left" [innerText]="'_InsightsComplianceIssues_' | i18n"></span>
				</div>
				<div>
					<span [innerText]="facet?.seriesData?.predictedCrashCnt"></span>
					<span class="qtr-padding-left" [innerText]="'_InsightsPredictedCrashes_' | i18n"></span>
				</div>
				<div>
					<span [innerText]="facet?.seriesData?.recentCrashCnt"></span>
					<span class="qtr-padding-left" [innerText]="'_InsightsRecentCrashes_' | i18n"></span>
				</div>
			</div>
			<div class="kmii__insights__change" *ngIf="false">
				<div  class="kmii__insights__arrow"
					inlineSVG="assets/icons/icon-arrow-down.svg">
				</div>
				<span [innerText]="'+2'"></span>
			</div>
		</div>
		<div class="kmii__insights__title" *ngIf="facet?.isError" [innerText]="'_InsightsNoResultsFound_' | i18n"></div>
	</div>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected"
	></div>
</ng-template>

<ng-template #advisoriesFacet let-facet="facet">
	<div class="kmii__detailed" *ngIf="!facet?.loading">
		<app-multi-gauge
			arcColor="#92dde4"
			*ngIf="facet?.seriesData"
			[data]="facet?.seriesData"
			[selected]="facet?.selected"
			[idx]="advisoryIndex"
		>
		</app-multi-gauge>
		<div
			*ngIf="!facet?.seriesData"
			class="text-muted flex-center text-large base-padding-left base-padding-right dbl-padding-top dbl-padding-bottom"
			[innerText]="'_NoOpenAdvisories_' | i18n">
		</div>
	</div>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected"
	></div>
</ng-template>

<ng-template #resolutionFacet let-facet="facet">
	<!-- TODO: Cases track needs to get trend data to draw the trend chart here -->
	<div class="kmii__detailed">
		<div class="text-left">
			<div class="kmii__resolution__item">
				<div
					class="kmii__resolution__label"
					[class.kmii__resolution__label--selected]="facet?.selected"
					[innerText]="'_OpenCases_' | i18n">
				</div>
				<div
					class="kmii_resolution__value"
					[class.kmii_resolution__value--selected]="facet?.selected"
					[innerText]="casesCount || 0">
				</div>
			</div>
			<div class="kmii__resolution__item qtr-margin-top">
				<div class="kmii__resolution__label" [innerText]="'_WithRMAs_' | i18n"></div>
				<div class="kmii_resolution__value" [innerText]="RMACount || 0"></div>
			</div>
		</div>
	</div>
	<p class="km__items__item__label" [innerText]="facet?.title | uppercase"></p>
	<div
		class="kmii__border"
		[class.kmii__border--selected]="facet?.selected">
	</div>
</ng-template>

<cui-modal></cui-modal>
