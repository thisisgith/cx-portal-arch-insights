<div class="page-container">
	<div class="row">
		<div [ngClass]="{
			'col-md-2 no-padding-right inventory-sidebar': !status.sidebarCollapsed
			}">
			<alert-sidebar *ngIf="alertData"
				[collapsed]="status.sidebarCollapsed"
				(onCollapse)="status.sidebarCollapsed = $event"
				(onSelect)="onSelect($event)"
				[totalAssets]="totalAssets"
				[alertResults]="alertData"
				[alertDetails]="alertDetails">
			</alert-sidebar>
		</div>
		<div class="base-margin-top" [ngClass]="{
			'col-md-10': !status.sidebarCollapsed,
			'col-md-12 dbl-padding-left base-padding-right': status.sidebarCollapsed
			}">
			<div class="base-margin-right">
				<ng-container *ngTemplateOutlet="advisories; context: {}"></ng-container>
				<ng-container *ngTemplateOutlet="inventory; context: {}"></ng-container>
			</div>
		</div>
	</div>
</div>

<ng-template #advisories>
	<div id="advisory-tabs" class="row no-gutters flex">
		<div *ngFor="let tab of tabs"
			class="col-md-3 half-padding-top half-padding-bottom flex-center"
			(click)="tab.subTabs ? selectTab(tab) : null"
			data-auto-id="AdvisoryTabs"
			[ngClass]="{ 'panel--mdgray': !tab.selected, 'alert-tab-selected': tab.selected }">
			<span class="text-uppercase text-xlarge"
				[ngClass]="{ 'text-muted': !tab.selected }"
				[innerText]="tab.title | i18n"
				[title]="tab.title | i18n">
			</span>
			<span *ngIf="tab.icon"
				class="text-large icon-{{ tab.icon }} half-margin-left">
			</span>
		</div>
		<div class="col-md-3 half-padding-top half-padding-bottom panel--mdgray text-right">
			<a [routerLink]="['/']">
				<span class="half-padding-right half-padding-top
					text-large text-dkgray-4 icon-data-usage"></span>
			</a>
		</div>
	</div>
	<div class="panel panel--bordered-bottom qtr-margin-bottom" *ngIf="selectedTab">
		<div class="row no-gutters">
			<div class="col-md-12" *ngIf="status.alertLoading">
				<div class="panel panel--loose">
					<cui-spinner></cui-spinner>
				</div>
			</div>
			<ng-container *ngIf="!status.alertLoading && selectedTab">
				<div class="col-md-3"
					*ngFor="let sub of selectedTab.subTabs"
					data-auto-id="AdvisorySubTabs"
					(click)="!sub.disabled ? selectSubTab(sub) : null"
					[ngClass]="{ 'arrowBox': sub.selected }">
					<ng-container *ngTemplateOutlet="infoContainer; context: { options: sub }"></ng-container>
				</div>
			</ng-container>
		</div>
	</div>
	<div class="alert-panel-popup" *ngIf="selectedTab && subTab">
		<alert-info [options]="{
				key: subTab.key,
				gauges: subTab.gauges,
				data: subTab.data,
				table: subTab.table,
				title: subTab.title
			}"
			(onSelect)="onSelect($event)">
		</alert-info>
	</div>
</ng-template>

<ng-template #infoContainer let-options="options">
	<div class="flex flex-center">
		<span class="text-uppercase text-medium text-muted qtr-padding-top"
			[innerText]="options.title">
		</span>
		<span class="base-margin-left text-xsmall no-padding-bottom
			text-bold text-muted icon-chevron-right">
		</span>
	</div>
	<div class="flex flex-center-horizontal info-container">
		<div class="base-margin-top"
			[ngClass]="{
				'base-margin-right': options.chart,
				'half-margin-right': options.summary
			}">
			<span class="text-giant" [innerText]="options.count"></span>
		</div>
		<div *ngIf="options.chart" [chart]="options.chart"></div>
		<div *ngIf="!options.chart && options.summary"
			class="summary-text text-small base-margin-top"
			[innerText]="options.summary">
		</div>
	</div>
</ng-template>

<ng-template #severityTemplate let-celldata="celldata">
	<span class="flex-center icon-circle text--{{ severities[celldata.severity].class }}"></span>
</ng-template>

<ng-template #lifecycleAnnouncement let-celldata="celldata">
	<span innerText="{{ celldata.type }} - {{ celldata.title }}"></span>
</ng-template>

<ng-template #inventory>
	<div class="base-margin-top base-margin-bottom">
		<div class="panel qtr-padding-top qtr-padding-bottom">
			<div id="tableheaderpanel" class="row">
				<div class="col-md-9 flex flex-center-vertical">
					<span class="text-large"
						innerText="{{ ((assets.length < totalAssets) ? '_ImpactedAssets_' : '_Assets_ ') | i18n }}">
					</span>
					<span class="base-margin-left text-muted"
						[innerText]="'_XofY_' | i18n:assets.length:totalAssets">
					</span>
				</div>
				<div class="col-md-3">
					<div class="flex flex-fluid">
						<div class="flex-fill form-group input--icon half-margin-right">
							<div class="form-group__text">
								<input id="asset-search"
									type="search"
									value=""
									[placeholder]="'_SearchAssets_' | i18n">
								<button type="button" class="link">
									<span class="icon-search"></span>
								</button>
							</div>
						</div>
						<div class="btn-group btn-group--square">
							<button class="btn btn--gray-ghost selected" (click)="toggleSoftwareColumns()" data-auto-id="showmorecolumn">
								<span class="icon-list-view"></span>
							</button>
							<button class="btn btn--gray-ghost">
								<span class="icon-grid-view"></span>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="responsive-table assets-table">
		<table id="mytable" class="table table--fixed table--hover table--loose table--selectable" 
			*ngIf="assets && assets.length">
			<thead>
				<tr>
					<th class="sortable" (click)="onSort()" data-auto-id="sortabletitle">
						<b [innerText]="'_Hostname_' | i18n"></b>
						<span 
							class="sort-indicator" 
							[ngClass]="{ 'icon-chevron-down': sortDirection === 'desc', 'icon-chevron-up': sortDirection === 'asc' }">
						</span>
					</th>
					<th class="table-header" [innerText]="'_ProductId_' | i18n"></th>
					<th class="table-header" [innerText]="'_IpAddress_' | i18n"></th>
					<th class="table-header" [innerText]="'_SerialNumber_' | i18n"></th>
					<th *ngIf="!hideSoftwareColumns" class="table-header" [innerText]="'_SoftwareType_' | i18n"></th>
					<th *ngIf="!hideSoftwareColumns" class="table-header" [innerText]="'_SoftwareVersion_' | i18n"></th>
				</tr>
			</thead>
			<tbody>
				<tr class="clickable-row" *ngFor="let asset of assets"
					(click)="clickTableRow(asset._id)" data-auto-id="assetrow"
					[ngClass]="{'active': asset.status && showSidePanel}">
					<td class="table-data" [innerText]="asset.hostname"></td>
					<td class="table-data" [innerText]="asset.productId"></td>
					<td class="table-data" [innerText]="asset.ipAddress"></td>
					<td class="table-data" [innerText]="asset.serialNumber"></td>
					<td *ngIf="!hideSoftwareColumns" class="table-data" [innerText]="asset.softwareType"></td>
					<td *ngIf="!hideSoftwareColumns" class="table-data" [innerText]="asset.softwareVersion"></td>					
				</tr>
			</tbody>
		</table>
	</div>
</ng-template>

<div class="asset-detail-panel panel panel--open" *ngIf="showSidePanel">
	<div class="panel-block">
		<a class="no-link fade-in-pop closebtn"
			(click)="closeSidePanel()"
			data-auto-id="closebtn">
			<span class="icon-close icon-medium"></span>
		</a>
		<h4 class="text-center base-margin-top base-margin-bottom"
			[innerText]="selectedAsset.hostname">
		</h4>
		<p class="text-center">
			<img alt="'_Cat3650Img_' | i18n"
				id="deviceimage"
				src="assets/img/inventory/CAT-3650.png">
		</p>
		<p class="text-center" [innerText]="selectedAsset.sysName"></p>
		<ul class="list list--inline">
			<li class="deviceinfo panel haft-margin-bottom">
				<dl>
					<dt class="descTitle text-uppercase"
						[innerText]="'_ProductId_' | i18n"
						data-auto-id="productId">
					</dt>
					<dd [innerText]="selectedAsset.productId || 'N/A'"></dd>

					<dt class="descTitle text-uppercase"
						[innerText]="'_ProductFamily_' | i18n"
						data-auto-id="productfamily">
					</dt>
					<dd [innerText]="selectedAsset.productFamily || 'N/A'"></dd>

					<dt class="descTitle text-uppercase"
						[innerText]="'_ProductSeries_' | i18n"
						data-auto-id="productseries">
					</dt>
					<dd [innerText]="selectedAsset.productSeries || 'N/A'"></dd>

				</dl>
			</li>
			<li class="deviceinfo panel half-margin-bottom">
				<dt class="descTitle text-uppercase"
					[innerText]="'_IPAddress_' | i18n"
					data-auto-id="ipAddress">
				</dt>
				<dd [innerText]="selectedAsset.ipAddress || 'N/A'"></dd>

				<dt class="descTitle text-uppercase"
					[innerText]="'_SerialNo_' | i18n"
					data-auto-id="serialno">
				</dt>
				<dd [innerText]="selectedAsset.serialNumber || 'N/A'"></dd>

				<dt class="descTitle text-uppercase"
					[innerText]="'_Software_' | i18n"
					data-auto-id="software">
				</dt>
				<dd [innerText]="selectedAsset.swVersion || 'N/A'"></dd>
			</li>
		</ul>
		<ul id="tabds" class="tabs tabs--centered">
			<li id="tabds-1"
				class="tab"
				[ngClass]="{'active': currentTab === 'vulnerability'}"
				(click)="selectDetailTab('vulnerability')"
				data-auto-id="vultab">
				<a tabindex="0">
					<div class="tab__heading"
						[innerText]="'_Vulnerabilities_' | i18n"
						data-auto-id="vultabhead">
					</div>
				</a>
			</li>
			<li id="tabds-2"
				class="tab"
				[ngClass]="{'active': currentTab === 'health'}"
				(click)="selectDetailTab('health')"
				data-auto-id="healthtab">
				<a tabindex="0">
					<div class="tab__heading"
						[innerText]="'_Health_' | i18n"
						data-auto-id="healthhead">
					</div>
				</a>
			</li>
			<li id="tabds-3"
				class="tab"
				[ngClass]="{'active': currentTab === 'coverage'}"
				(click)="selectDetailTab('coverage')"
				data-auto-id="covertab">
				<a tabindex="0">
					<div class="tab__heading" 
						[innerText]="'_Coverage_' | i18n"
						data-auto-id="coverhead">
					</div>
				</a>
			</li>
		</ul>
		<div id="tabds-content" class="tab-content">
			<div id="tabds-1-content" *ngIf="currentTab === 'vulnerability'">
				<div *ngIf="showSidePanel"
					id="vulbtngroup"
					class="btn-group base-margin-top base-margin-bottom">
					<button id="securityadvisory"
						class="button text-lowercase"
						[ngStyle]="{background: currentButton === 'securityadvisory' ? 'darkgray' : 'white'}"
						[innerText]="'_SecurityAdvisory_' | i18n"
						(click)="clickButton('securityadvisory')"
						data-auto-id="securebutton">
					</button>
					<button id="fieldnotice"
						class="button text-lowercase"
						[ngStyle]="{background: currentButton === 'fieldnotice' ? 'darkgray' : 'white'}"
						[innerText]="'_FieldNotice_' | i18n"
						(click)="clickButton('fieldnotice')"
						data-auto-id="fieldbutton">
					</button>
				</div>
				<div *ngIf="currentButton === 'securityadvisory'">
					<ul>
						<li>
							<ul class="deviceVul list list--inline">
								<li class="devicename"
									[innerText]="'_CVE20173881_' | i18n"
									data-auto-id="lidevicename1">
								</li>
								<li class="version"
									[innerText]="'_V1.1_' | i18n"
									data-auto-id="liversion1">
								</li>
								<li class="date"
									[innerText]="'_Update3Days_' | i18n"
									data-auto-id="lidate1">
								</li>
							</ul>
						</li>
						<p [innerText]="'_VulnerabilityDetail1_' | i18n" data-auto-id="vuldetail1"></p>
						<li>
							<ul class="deviceVul list list--inline">
								<li class="devicename"
									[innerText]="'_CVE20173881_' | i18n"
									data-auto-id="lidevicename2">
								</li>
								<li class="version"
									[innerText]="'_V1.1_' | i18n"
									data-auto-id="liversion2">
								</li>
								<li class="date"
									[innerText]="'_Update3Days_' | i18n"
									data-auto-id="lidate2">
								</li>
							</ul>
						</li>
						<p [innerText]="'_VulnerabilityDetail1_' | i18n" data-auto-id="vuldetail2"></p>
					</ul>
					<ul *ngIf="less === false">
						<li>
							<ul class="deviceVul list list--inline">
								<li class="devicename"
									[innerText]="'_CVE20173881_' | i18n"
									data-auto-id="lidevicename3">
								</li>
								<li class="version"
									[innerText]="'_V1.1_' | i18n"
									data-auto-id="liversion3">
								</li>
								<li class="date"
									[innerText]="'_Update3Days_' | i18n"
									data-auto-id="lidate3">
								</li>
							</ul>
						</li>
						<p [innerText]="'_VulnerabilityDetail1_' | i18n" data-auto-id="vuldetail3"></p>
					</ul>
					<div class="base-margin-left">
						<a *ngIf="less === true"
							(click)="showMore()"
							data-auto-id="showmore">
							<p [innerText]="'_ViewMore_' | i18n"></p>
						</a>
						<a *ngIf="less === false"
							(click)="showLess()"
							data-auto-id="showless">
							<p [innerText]="'_ViewLess_' | i18n"></p>
						</a>
					</div>
				</div>
				<div *ngIf="currentButton === 'fieldnotice'">
					<p [innerText]="'_FieldNoticeDetail_' | i18n" data-auto-id="fielddetail"></p>
				</div>
			</div>
			<div id="tabds-2-content" *ngIf="currentTab === 'health'">
				<p [innerText]="'_HealthDetail_' | i18n" data-auto-id="healthdetail"></p>
			</div>
			<div id="tabds-3-content" *ngIf="currentTab === 'coverage'">
				<p [innerText]="'_CoverageDetail_' | i18n" data-auto-id="coverdetail"></p>
			</div>
		</div>
	</div>
</div>